!function(t){var e=self;e.Backbone=function(t,a,p,e){var i=t.Backbone;Array.prototype.slice;a.VERSION="1.3.3",a.$=e,a.noConflict=function(){return t.Backbone=i,this};var h,n=a.Events={},o=/\s+/,c=function(t,e,i,n,s){var r,a=0;if(i&&"object"==typeof i){void 0!==n&&"context"in s&&void 0===s.context&&(s.context=n);for(r=p.keys(i);a<r.length;a++)e=c(t,e,r[a],i[r[a]],s)}else if(i&&o.test(i))for(r=i.split(o);a<r.length;a++)e=t(e,r[a],n,s);else e=t(e,i,n,s);return e};n.on=function(t,e,i){if(this._events=c(s,this._events||{},t,e,{context:i,ctx:this,listening:h}),h){var n=this._listeners||(this._listeners={});(n[h.id]=h).interop=!1}return this},n.listenTo=function(t,e,i){if(!t)return this;var n=t._listenId||(t._listenId=p.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),r=h=s[n];r||(this._listenId||(this._listenId=p.uniqueId("l")),r=h=s[n]=new g(this,t));var a=l(t,e,i,this);if(h=void 0,a)throw a;return r.interop&&r.on(e,i),this};var s=function(t,e,i,n){if(i){var s=t[e]||(t[e]=[]),r=n.context,a=n.ctx,h=n.listening;h&&h.count++,s.push({callback:i,context:r,ctx:r||a,listening:h})}return t},l=function(t,e,i,n){try{t.on(e,i,n)}catch(t){return t}};n.off=function(t,e,i){return this._events&&(this._events=c(r,this._events,t,e,{context:i,listeners:this._listeners})),this},n.stopListening=function(t,e,i){var n=this._listeningTo;if(!n)return this;for(var s=t?[t._listenId]:p.keys(n),r=0;r<s.length;r++){var a=n[s[r]];if(!a)break;a.obj.off(e,i,this),a.interop&&a.off(e,i)}return p.isEmpty(n)&&(this._listeningTo=void 0),this};var r=function(t,e,i,n){if(t){var s,r=n.context,a=n.listeners,h=0;if(e||r||i){for(s=e?[e]:p.keys(t);h<s.length;h++){e=s[h];var o=t[e];if(!o)break;for(var c=[],l=0;l<o.length;l++){var u=o[l];if(i&&i!==u.callback&&i!==u.callback._callback||r&&r!==u.context)c.push(u);else{var f=u.listening;f&&f.off(e,i)}}c.length?t[e]=c:delete t[e]}return t}for(s=p.keys(a);h<s.length;h++)a[s[h]].cleanup()}};n.once=function(t,e,i){var n=c(u,{},t,e,this.off.bind(this));return"string"==typeof t&&null==i&&(e=void 0),this.on(n,e,i)},n.listenToOnce=function(t,e,i){var n=c(u,{},e,i,this.stopListening.bind(this,t));return this.listenTo(t,n)};var u=function(t,e,i,n){if(i){var s=t[e]=p.once(function(){n(e,s),i.apply(this,arguments)});s._callback=i}return t};n.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return c(f,this._events,t,void 0,i),this};var f=function(t,e,i,n){if(t){var s=t[e],r=t.all;s&&r&&(r=r.slice()),s&&d(s,n),r&&d(r,[e].concat(n))}return t},d=function(t,e){var i,n=-1,s=t.length,r=e[0],a=e[1],h=e[2];switch(e.length){case 0:for(;++n<s;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,a,h);return;default:for(;++n<s;)(i=t[n]).callback.apply(i.ctx,e);return}},g=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};g.prototype.on=n.on,g.prototype.off=function(t,e){var i;this.interop?(this._events=c(r,this._events,t,e,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},g.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},n.bind=n.on,n.unbind=n.off,p.extend(a,n);var v=a.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},_=/\((.*?)\)/g,m=/(\(\?)?:\w+/g,y=/\*\w+/g,x=/[\-{}\[\]+?.,\\\^$|#\s]/g;p.extend(v.prototype,n,{preinitialize:function(){},initialize:function(){},route:function(i,n,s){p.isRegExp(i)||(i=this._routeToRegExp(i)),p.isFunction(n)&&(s=n,n=""),s||(s=this[n]);var r=this;return a.history.route(i,function(t){var e=r._extractParameters(i,t);!1!==r.execute(s,e,n)&&(r.trigger.apply(r,["route:"+n].concat(e)),r.trigger("route",n,e),a.history.trigger("route",r,n,e))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,e){return a.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=p.result(this,"routes");for(var t,e=p.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(x,"\\$&").replace(_,"(?:$1)?").replace(m,function(t,e){return e?t:"([^/?]+)"}).replace(y,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return p.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var w=a.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},b=/^[#\/]|\s+$/g,k=/^\/+|\/+$/g,H=/#.*$/;w.started=!1,p.extend(w.prototype,n,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(b,"")},start:function(t){if(w.started)throw new Error("Backbone.history has already been started");if(w.started=!0,this.options=p.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(k,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,n=i.insertBefore(this.iframe,i.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var s=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),w.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),p.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(t,e){if(!w.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;t=t.replace(H,"");var s=this.decodeFragment(t);if(this.fragment!==s){if(this.fragment=s,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),a.history=new w;return v.extend=w.extend=function(t,e){var i,n=this;return i=t&&p.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},p.extend(i,n,e),i.prototype=p.create(n.prototype,t),(i.prototype.constructor=i).__super__=n.prototype,i},a}(e,{},e._,e.jQuery)}();